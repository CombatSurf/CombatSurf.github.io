<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CombatSurf - Comments</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="comments.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <header>
    <div class="logo">
      <img src="images/logo.png" alt="CombatSurf Logo" id="logo-img">
    </div>
    <nav>
      <ul class="nav-links">
        <li class="auth-status logged-out"><a href="login.html"><i class="fas fa-user"></i> log/reg</a></li>
        <li class="auth-status logged-in">
          <a href="#"><i class="fas fa-user-circle"></i> <span class="username">User</span> <i class="fas fa-caret-down"></i></a>
          <div class="dropdown-menu">
            <a href="#" class="logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</a>
          </div>
        </li>
        <li><a href="index.html"><i class="fas fa-home"></i> home<br>home wb</a></li>
        <li><a href="rap-price.html"><i class="fas fa-tags"></i> rap<br>price</a></li>
        <li><a href="skins.html"><i class="fas fa-palette"></i> index skins<br>value & Previews</a></li>
        <li><a href="https://discord.gg/combatsurf" target="_blank"><i class="fab fa-discord"></i> discord comunity<br>roblox group</a></li>
        <li><a href="updates.html"><i class="fas fa-sync-alt"></i> updates<br>changelog</a></li>
        <li><a href="comments.html" class="active"><i class="fas fa-comments"></i> comments<br>people's comments</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <section class="comments-section">
      <h1>Community Comments</h1>
      <p class="section-description">Share your thoughts with the CombatSurf community!</p>
      
      <div class="auth-status logged-out">
        <div class="login-prompt">
          <i class="fas fa-lock"></i>
          <p>Please <a href="login.html">login</a> to leave a comment</p>
        </div>
      </div>
      
      <div class="auth-status logged-in">
        <div class="comment-form-container">
          <h3><i class="fas fa-pen"></i> Write a comment</h3>
          <form id="comment-form">
            <textarea id="comment-content" placeholder="Share your thoughts..." required></textarea>
            <button type="submit" class="submit-btn"><i class="fas fa-paper-plane"></i> Post Comment</button>
          </form>
        </div>
      </div>
      
      <div class="comments-container">
        <h3><i class="fas fa-comments"></i> Recent Comments</h3>
        <div id="comments-list">
          <!-- Los comentarios se cargarán dinámicamente aquí -->
          <div class="no-comments-message">
            <i class="fas fa-comment-slash"></i>
            <p>No comments yet. Be the first to comment!</p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <p>Dev Website Brownuser_ <i class="fas fa-code"></i></p>
  </footer>

  <script src="auth.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Cargar comentarios
      loadComments();
      
      // Configurar el formulario de comentarios
      const commentForm = document.getElementById('comment-form');
      if (commentForm) {
        commentForm.addEventListener('submit', function(e) {
          e.preventDefault();
          
          if (!isAuthenticated()) {
            alert('You must be logged in to comment');
            return;
          }
          
          const content = document.getElementById('comment-content').value.trim();
          if (!content) {
            alert('Please write something before posting');
            return;
          }
          
          addComment(content);
          commentForm.reset();
        });
      }
    });
    
    // Cargar comentarios desde localStorage
    function loadComments() {
      const commentsContainer = document.getElementById('comments-list');
      const comments = JSON.parse(localStorage.getItem('comments') || '[]');
      
      // Limpiar el contenedor
      commentsContainer.innerHTML = '';
      
      if (comments.length === 0) {
        commentsContainer.innerHTML = `
          <div class="no-comments-message">
            <i class="fas fa-comment-slash"></i>
            <p>No comments yet. Be the first to comment!</p>
          </div>
        `;
        return;
      }
      
      // Ordenar comentarios por fecha (más recientes primero)
      comments.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
      
      // Mostrar cada comentario
      comments.forEach(comment => {
        const commentElement = createCommentElement(comment);
        commentsContainer.appendChild(commentElement);
      });
    }
    
    // Crear elemento de comentario
    function createCommentElement(comment) {
      const currentUser = getCurrentUser();
      const isUserAdmin = isAdmin();
      const isCommentAuthor = currentUser && currentUser.username === comment.author;
      
      const commentDiv = document.createElement('div');
      commentDiv.className = 'comment-item';
      commentDiv.dataset.id = comment.id;
      
      // Formatear la fecha
      const date = new Date(comment.createdAt);
      const formattedDate = date.toLocaleDateString('es-ES', { 
        year: 'numeric', 
        month: 'short', 
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
      
      // Determinar la clase de autor
      let authorClass = '';
      let authorBadge = '';
      
      if (comment.role === 'admin') {
        authorClass = 'admin-author';
        authorBadge = '<span class="author-badge admin">Admin</span>';
      }
      
      commentDiv.innerHTML = `
        <div class="comment-header">
          <div class="comment-author ${authorClass}">
            <i class="fas fa-user-circle"></i>
            <span>${comment.author}</span>
            ${authorBadge}
          </div>
          <div class="comment-date">
            <i class="far fa-clock"></i>
            <span>${formattedDate}</span>
          </div>
        </div>
        <div class="comment-content">
          <p>${comment.content}</p>
        </div>
        <div class="comment-actions">
          ${(isUserAdmin || isCommentAuthor) ? 
            `<button class="delete-btn" onclick="deleteComment('${comment.id}')">
              <i class="fas fa-trash-alt"></i> Delete
            </button>` : ''}
        </div>
      `;
      
      return commentDiv;
    }
    
    // Añadir un nuevo comentario
    function addComment(content) {
      if (!isAuthenticated()) return;
      
      const currentUser = getCurrentUser();
      const comments = JSON.parse(localStorage.getItem('comments') || '[]');
      
      const newComment = {
        id: Date.now().toString(),
        author: currentUser.username,
        role: currentUser.role || 'user',
        content: content,
        createdAt: new Date().toISOString()
      };
      
      comments.push(newComment);
      localStorage.setItem('comments', JSON.stringify(comments));
      
      // Recargar comentarios
      loadComments();
      
      // Mostrar animación
      const commentsContainer = document.getElementById('comments-list');
      const firstComment = commentsContainer.querySelector('.comment-item');
      if (firstComment) {
        firstComment.classList.add('highlight');
        setTimeout(() => {
          firstComment.classList.remove('highlight');
        }, 1500);
      }
    }
    
    // Eliminar un comentario
    function deleteComment(commentId) {
      if (!isAuthenticated()) return;
      
      const currentUser = getCurrentUser();
      let comments = JSON.parse(localStorage.getItem('comments') || '[]');
      
      // Encontrar el comentario
      const comment = comments.find(c => c.id === commentId);
      
      // Verificar permisos (solo el autor o un administrador pueden eliminar)
      if (!comment || (comment.author !== currentUser.username && currentUser.role !== 'admin')) {
        alert('You do not have permission to delete this comment');
        return;
      }
      
      // Animar la eliminación
      const commentElement = document.querySelector(`.comment-item[data-id="${commentId}"]`);
      if (commentElement) {
        commentElement.classList.add('deleting');
        
        setTimeout(() => {
          // Filtrar el comentario
          comments = comments.filter(c => c.id !== commentId);
          localStorage.setItem('comments', JSON.stringify(comments));
          
          // Recargar comentarios
          loadComments();
        }, 500);
      }
    }
  </script>
</body>
</html>
